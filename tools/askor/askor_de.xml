<tool id="askor_de" name="AskoR_DE" version="0.01">
    <description>Edger for askomics </description>
    <requirements>
        <requirement type="package" version="3.34.6">bioconductor-limma</requirement>
        <requirement type="package" version="1.4.29">r-statmod</requirement>
        <requirement type="package" version="3.20.7">bioconductor-edger</requirement>
        <requirement type="package" version="2.2.1">r-ggplot2</requirement>
        <requirement type="package" version="1.1_2">r-rcolorbrewer</requirement>
        <requirement type="package" version="0.7.0">r-ggrepel</requirement>
        <requirement type="package" version="3.0.1">r-gplots</requirement>
        <requirement type="package" version="1.3.2">r-optparse</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
      export ASKOR_PATH='$__tool_directory__' &&
      Rscript '$__tool_directory__/Asko_DE.R'
      --out ${out_pdf}
      --outdir askor_output
      --fileofcount ${fileofcounts}
      --samples ${samples}
      --contrasts ${contrasts}
      #if ${adv.organism}
        --org ${adv.organism}
      #end if
      #if ${adv.colgenes}
        --col_genes ${adv.colgenes}
      #end if
      #if ${adv.sep}
        --sep ${adv.sep}
      #end if
      #if ${adv.palette}
        --palette ${adv.palette}
      #end if
      #if ${selection.sel}
        --select ${selection.sel}
      #end ${sel}
      #if ${selection.remove}
        --remove ${selection.remove}
      #end if
      #if ${thresholds.th_cpm}
        --th_cpm ${thresholds.th_cpm}
      #end if
      #if ${thresholds.rep}
        --rep ${thresholds.rep}
      #end if
      #if ${thresholds.fdr}
        --th_FDR ${thresholds.fdr}
      #end if
      #if ${stats.norm}
        --normalization ${stats.norm}
      #end if
      #if ${stats.adj}
        --adj ${stats.adj}
      #end if
      #if ${stats.glm}
        --glm ${stats.glm}
      #end if
      #if ${adv.nh}
        --nh ${adv.nh}
      #end if
    ]]></command>
    <inputs>
        <param format="tsv" name="fileofcounts" type="data" label="File of counts" />
        <param format="tsv" name="samples" type="data" label="descriptions of the samples" />
        <param format="tsv" name="contrasts" type="data" label="descriptions of the contrasts" />
        <section name="adv" title="Format options" expanded="false">
          <param name="colgenes" type="integer" label="Column of the genes" value="1" optional="true" />
          <param name="sep" type="text" label="field separator" value="\t" optional="true" />
          <param name="palette" type="text" label="color palette (Rcolorbrewer)" value="Set2" optional="true" />
          <param name="organism" type="text" label="organism" value="Asko" optional="true" />
          <param name="nh" type="integer" label="number of genes in the heatmap" value="50" optional="true" />
        </section>
        <section name="selection" title="Samples selection options" expanded="false">
          <param name="sel" type="text" label="list of selected samples (separated by comma)" value="" optional="true" />
          <param name="remove" type="text" label="list of removed samples (separated by comma)" value="" optional="true" />
        </section>
        <section name="thresholds" title="Threshold options" expanded="false">
            <param name="th_cpm" type="float" label="minimum CPM value for selecting a gene" value="0.5" optional="true" />
            <param name="rep" type="integer" label="number of samples with CPM > th_comp for selecting a gene" value="3" optional="true" />
            <param name="th_FDR" type="float" label="FDR threshold for reporting a differential gene" value="0.05" optional="true" />
        </section>
        <section name="stats" title="Statistics options" expanded="false">
          <param name="norm" type="select" label="normalization method">
            <option value="TMM">TMM</option>
            <option value="RLE">RLE</option>
            <option value="upperquartile">upperquartile</option>
            <option value="upperquartile">none</option>
          </param>
          <param name="GLM" type="select" label="GLM method">
            <option value="qlf">qlf</option>
            <option value="lrt">lrt</option>
          </param>
          <param name="adj" type="select" label="Multitest correction method">
            <option value="fdr">fdr</option>
            <option value="holm">holm</option>
            <option value="hochberg">hochberg</option>
            <option value="hommel">hommel</option>
            <option value="bonferroni">bonferroni</option>
            <option value="BH">BH</option>
            <option value="BY">BY</option>
            <option value="none">none</option>
          </param>
        </section>
    </inputs>
    <outputs>
        <data format="pdf" name="out_pdf" label="${tool.name} on ${on_string}: Graphics" />
        <data name="output" format="tsv" label="${tool.name} on ${on_string}">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.txt" ext="tsv" visible="true" directory="askor_output" />
        </data>
    </outputs>
    <tests>
        <test>
            <param name="fileofcount" value="counts.csv" />
            <param name="samples" value="Samples.txt" />
            <param name="contrasts" value="Contrasts.txt" />
            <param name="colgenes" value="3" />
            <param name="th_cpm" value="10" />
            <output name="output">
              <discovered_dataset designation="AskoAvsK.txt" ftype="tabular">
                <assert_contents><has_n_columns n="16" /></assert_contents>
              </discovered_dataset>
              <discovered_dataset designation="contrast.asko.txt" ftype="tabular">
                <assert_contents><has_line line="T1AvsT1K T1A T1K" /></assert_contents>
              </discovered_dataset>
            </output>
        </test>
    </tests>
    <help>
      This tools generates list of differential genes from various contrasts in an Askomics format
    </help>
    <citations>
    </citations>
</tool>
