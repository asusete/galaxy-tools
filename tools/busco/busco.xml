<tool id="busco" name="Busco" version="1.1b1">
    <description>assess genome assembly and annotation completeness</description>

    <requirements>
        <requirement type="package" version="1.1b1">busco</requirement>
        <requirement type="package" version="3.1">augustus</requirement>
        <requirement type="package" version="2.2.31">blast+</requirement>
        <requirement type="package" version="3.1b2">hmmer</requirement>
        <requirement type="package" version="3.4">python</requirement>
    </requirements>

    <stdio>
        <exit_code range="1:" />
    </stdio>

    <command><![CDATA[
        python3 \${BUSCO_ROOT_PATH}/BUSCO.py
        -in "${input}"
        -l "\${BUSCO_DATA_PATH}/${lineage}"
        -m "${mode}"
        -o "busco_galaxy"
        -c \${GALAXY_SLOTS:-4}
        -ev ${adv.ev}
        ${adv.long}
        #if ($adv.flank):
            -flank ${adv.flank}
        #end if
        -sp ${adv.species}
    ]]></command>
    
    <inputs>
    
        <param type="data" name="input" format="fasta" label="Sequences to analyse" help="genome, transcriptome or proteome" />
    
        <param name="lineage" type="select" label="Lineage">
            <option value="arthropoda">Arthropoda</option>
            <option value="bacteria">Bacteria</option>
            <option value="eukaryota">Eukaryota</option>
            <option value="fungi">Fungi</option>
            <option value="metazoa">Metazoa</option>
            <option value="vertebrata">Vertebrata</option>
        </param>
    
        <param name="mode" type="select" label="Mode">
            <option value="all">Genome</option>
            <option value="trans">Transcriptome</option>
            <option value="OGS">Proteome</option>
        </param>
        
        <section name="adv" title="Advanced Options" expanded="False">
            <param name="ev" type="float" value="0.01" label="E-value cutoff for BLAST searches."/>
            <param name="flank" type="integer" value="" optional="True" label="Flanking sequence size for candidate regions" help="If not provided, flank size is calculated based on genome size with a range from 5 to 20 Kbp."/>
            <param name="species" type="text" value="generic" label="Name of existing Augustus species gene finding metaparameters"/>
            <param name="long" type="boolean" checked="false" truevalue="--long" falsevalue="" label="Optimization mode Augustus self-training" help="Adds ~20h extra run time, but can improve results for some non-model organisms"/>
        </section>
    </inputs>
    <outputs>
        <data name='busco_sum' format='txt' label="${tool.name} on ${on_string}: short summary" from_work_dir="run_busco_galaxy/short_summary_busco_galaxy"/>
        <data name='busco_table' format='tabular' label="${tool.name} on ${on_string}: full table" from_work_dir="run_busco_galaxy/full_table_busco_galaxy"/>
        <data name='busco_missing' format='tabular' label="${tool.name} on ${on_string}: missing buscos" from_work_dir="run_busco_galaxy/missing_buscos_list_busco_galaxy"/>
    </outputs>
    <tests>
        <test>
            <param name="input" value="genome.fa"/>
            <param name="lineage" value="arthropoda"/>
            <param name="mode" value="all"/>
            <output name="busco_sum" file="genome_results/short_summary" compare="contains"/>
            <output name="busco_table" file="genome_results/full_table" compare="contains"/>
            <output name="busco_missing" file="genome_results/missing_buscos_list" compare="contains"/>
        </test>
        <test>
            <param name="input" value="proteome.fa"/>
            <param name="lineage" value="arthropoda"/>
            <param name="mode" value="OGS"/>
            <output name="busco_sum" file="proteome_results/short_summary" compare="contains"/>
            <output name="busco_table" file="proteome_results/full_table" compare="contains"/>
            <output name="busco_missing" file="proteome_results/missing_buscos_list" compare="contains"/>
        </test>
        <test>
            <param name="input" value="transcriptome.fa"/>
            <param name="lineage" value="arthropoda"/>
            <param name="mode" value="trans"/>
            <output name="busco_sum" file="transcriptome_results/short_summary" compare="contains"/>
            <output name="busco_table" file="transcriptome_results/full_table" compare="contains"/>
            <output name="busco_missing" file="transcriptome_results/missing_buscos_list" compare="contains"/>
        </test>
    </tests>
    <help>
        BUSCO: assessing genome assembly and annotation completeness with Benchmarking Universal Single-Copy Orthologs
        
        .. _BUSCO: http://busco.ezlab.org/
    </help>
    
     <citations>
        <citation type="doi">doi:10.1093/bioinformatics/btv351</citation>
    </citations>
</tool>
